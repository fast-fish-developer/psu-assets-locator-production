"use strict";exports.id=603,exports.ids=[603],exports.modules={8895:(t,e,i)=>{i.r(e),i.d(e,{"0054899b10ed34cd2fa133648466dbd16f279ed2a0":()=>s.xy,"005dac92b95ad4508d12ffde167296e7e36933321b":()=>s.ES,"00786e0cb14b8e4d5677baceca62f005885856eb94":()=>s.ri,"008bc2c7ba6d5d5f9d305e3753c3d9993dc458ce6b":()=>s.Ju,"00bc614560c8b89a198c8413e96e0094b51c25a1b6":()=>s.Ht,"00f66535b3f7e3b925e8851056c341d62b0302ee6a":()=>s.x0,"401438477ef9251cf6d50f4b523eb008dd954ad802":()=>s.qO,"4054d851e7ff19ddf75a4d000ea97ed0c2a91cce12":()=>s.Oj,"405a2fa769107152542e7ea1ece6e1c81f6fb6f7fa":()=>s.w,"405c6e103fcb547f95b149b39149a4e415e3ff5ab0":()=>s.iD,"40816ec9ddc9150859e3b7d132b09ebc9c7e9c3283":()=>s.Lb,"40d0810138f64f5fe8ff88e1086c48197197b87361":()=>s.FD,"40f107a9a1ed92ef4cb1dc92ca785fd6f291a9dde2":()=>s.Yc,"60c96956bcfa6a4d961911d2705fcea86abb69f712":()=>s.ht});var s=i(9289)},5953:(t,e,i)=>{i.d(e,{A:()=>to});var s=i(3131),o=i(8009),n=i(2540);class a extends n.fabric.Point{constructor(...t){let e,i;t.length>1?[e,i]=t:0!==t.length&&t[0]?Object.prototype.hasOwnProperty.call(t[0],"x")?(e=t[0].x,i=t[0].y):t[0].length?[[e,i]]=t:console.error("Parameter for Point is not valid. Use Point(x,y) or Point({x,y}) or Point([x,y])",t):[e,i]=[0,0],super(e,i)}setX(t){this.x=t||0}setY(t){this.y=t||0}copy(t){this.x=t.x,this.y=t.y}getArray(){return[this.x,this.y]}}let r={SELECT:"SELECT",GRAB:"GRAB",MEASURE:"MEASURE",DRAW:"DRAW"},h={center:new a,zoom:1,minZoom:0,maxZoom:20,gridEnabled:!0,zoomEnabled:!0,selectEnabled:!0,mode:r.SELECT,showGrid:!0};new a,fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",fabric.Object.prototype.lockUniScaling=!0,fabric.Object.prototype.lockScalingFlip=!0,fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.centeredScaling=!0,fabric.Object.prototype.cornerColor="blue",fabric.Object.prototype.borderColor="blue",fabric.Object.prototype.borderOpacity=.7,fabric.Object.prototype.cornerOpacity=.7,fabric.Object.prototype.cornerStrokeColor="blue",fabric.Object.prototype.borderColor="#ff0099",fabric.Object.prototype.cornerColor="#00eaff",fabric.Object.prototype.cornerStrokeColor="#00bbff",fabric.Object.prototype.objectCaching=!1,fabric.Group.prototype.objectCaching=!0,fabric.Group.prototype.selectionBackgroundColor="rgba(45,207,171,0.25)",fabric.Object.prototype.borderDashArray=[3,3],fabric.Object.prototype.padding=5,fabric.Object.prototype.getBounds=function(){let t=[];return t.push(new a(this.left-this.width/2,this.top-this.height/2)),t.push(new a(this.left+this.width/2,this.top+this.height/2)),t};let l=function(t){return"number"==typeof t&&!isNaN(t)};function c(t,e){let i=(e=e||t.currentTarget).getBoundingClientRect(),s=t.originalEvent||t,o=t.touches&&t.touches.length,n=0,a=0;o?l(t.touches[0].pageX)&&l(t.touches[0].pageY)?(n=t.touches[0].pageX,a=t.touches[0].pageY):l(t.touches[0].clientX)&&l(t.touches[0].clientY)&&(n=s.touches[0].clientX,a=s.touches[0].clientY):l(t.pageX)&&l(t.pageY)?(n=t.pageX,a=t.pageY):t.currentPoint&&l(t.currentPoint.x)&&l(t.currentPoint.y)&&(n=t.currentPoint.x,a=t.currentPoint.y);let r=!1;return"which"in t?r=3==t.which:"button"in t&&(r=2==t.button),{x:n-i.left,y:a-i.top,isRight:r}}window.addEventListener("touchmove",()=>{});class d{constructor({source:t=document,update:e,stop:i,multiplier:s=1,friction:o=.92,initialValues:n,boundX:a,boundY:r,bounce:h=!0}){let l,c,d,g,m,f,b,v,x,y,w;let k=0,C=0,j=.3*s,O=!1,E=!1,M=!1,z=!1,A=[];function L(){document.removeEventListener("touchmove",W,!!p()&&{passive:!1}),document.removeEventListener("touchend",P),document.removeEventListener("touchcancel",D),document.removeEventListener("mousemove",W,!!p()&&{passive:!1}),document.removeEventListener("mouseup",P)}function S(){e.call(t,k,C)}function R(t){if("touchmove"===t.type||"touchstart"===t.type||"touchend"===t.type){let e=t.targetTouches[0]||t.changedTouches[0];return{x:e.clientX,y:e.clientY,id:e.identifier}}return{x:t.clientX,y:t.clientY,id:null}}function T(t){let e=R(t);E||M||(E=!0,z=!1,x=e.id,m=b=e.x,f=v=e.y,A=[],Y(m,f),L(),document.addEventListener("touchmove",W,!!p()&&{passive:!1}),document.addEventListener("touchend",P),document.addEventListener("touchcancel",D),document.addEventListener("mousemove",W,!!p()&&{passive:!1}),document.addEventListener("mouseup",P))}function W(t){t.preventDefault();let e=R(t);E&&e.id===x&&(b=e.x,v=e.y,Y(m,f),O||u(F),O=!0)}function P(t){let e=R(t);E&&e.id===x&&D()}function D(){E=!1,Y(m,f),function(){let e=A[0],o=A[A.length-1],n=o.x-e.x,a=o.y-e.y,r=(o.time-e.time)/15/s;y=n/r||0,w=a/r||0;let h=X();Math.abs(y)>1||Math.abs(w)>1||!h.inBounds?(z=!0,u(I)):i&&i(t)}(),L()}function Y(t,e){let i=Date.now();for(;A.length>0&&!(i-A[0].time<=100);)A.shift();A.push({x:t,y:e,time:i})}function F(){let t=b-m,e=v-f;if(k+=t*s,C+=e*s,h){let i=X();0!==i.x&&(k-=t*B(i.x)*s),0!==i.y&&(C-=e*B(i.y)*s)}else X(!0);S(),m=b,f=v,O=!1}function B(t){return 5e-6*Math.pow(t,2)+1e-4*t+.55}function X(t){let e=0,i=0;return void 0!==l&&k<l?e=l-k:void 0!==c&&k>c&&(e=c-k),void 0!==d&&C<d?i=d-C:void 0!==g&&C>g&&(i=g-C),t&&(0!==e&&(k=e>0?l:c),0!==i&&(C=i>0?d:g)),{x:e,y:i,inBounds:0===e&&0===i}}function I(){if(!z)return;y*=o,w*=o,k+=y,C+=w;let e=X();if(Math.abs(y)>j||Math.abs(w)>j||!e.inBounds){if(h){if(0!==e.x){if(e.x*y<=0)y+=.04*e.x;else{let t=e.x>0?2.5:-2.5;y=(e.x+t)*.11}}if(0!==e.y){if(e.y*w<=0)w+=.04*e.y;else{let t=e.y>0?2.5:-2.5;w=(e.y+t)*.11}}}else 0!==e.x&&(k=e.x>0?l:c,y=0),0!==e.y&&(C=e.y>0?d:g,w=0);S(),u(I)}else z=!1,i&&i(t)}(function(){if(!(t="string"==typeof t?document.querySelector(t):t))throw Error("IMPETUS: source not found.");if(!e)throw Error("IMPETUS: update function not defined.");n&&(n[0]&&(k=n[0]),n[1]&&(C=n[1]),S()),a&&(l=a[0],c=a[1]),r&&(d=r[0],g=r[1]),t.addEventListener("touchstart",T),t.addEventListener("mousedown",T)})(),this.destroy=function(){return t.removeEventListener("touchstart",T),t.removeEventListener("mousedown",T),L(),null},this.pause=function(){L(),E=!1,M=!0},this.resume=function(){M=!1},this.setValues=function(t,e){"number"==typeof t&&(k=t),"number"==typeof e&&(C=e)},this.setMultiplier=function(t){j=.3*(s=t)},this.setBoundX=function(t){l=t[0],c=t[1]},this.setBoundY=function(t){d=t[0],g=t[1]}}}let u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};function p(){let t=!1;try{let e=Object.defineProperty({},"passive",{get(){t=!0}});window.addEventListener("test",null,e)}catch(t){console.log(t)}return p=()=>t,t}var g=i(5699),m=i.n(g),f={left:0,top:0};let b=function(t,e,i){e=e||t.currentTarget||t.srcElement,Array.isArray(i)||(i=[0,0]);var s,o=t.clientX||0,n=t.clientY||0,a=(s=e)===window||s===document||s===document.body?f:s.getBoundingClientRect();return i[0]=o-a.left,i[1]=n-a.top,i};function v(){this.position=[0,0],this.touch=null}function x(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var y=0;function w(t){var e=+new Date,i=Math.max(0,16-(e-y));return y=e+i,window.setTimeout(t,i)}var k=window.requestAnimationFrame||x("RequestAnimationFrame")||w,C=window.cancelAnimationFrame||x("CancelAnimationFrame")||x("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};let j=(t,e,i)=>{if(!i||k!==w)return k.call(window,function(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var s=i.call(arguments,2);return function(){return t.apply(e,s.length?s.concat(i.call(arguments)):arguments)}}(t,e));t.call(e)};j.cancel=t=>{t&&C.call(window,t)};class O{constructor(t,e=80,i=12,s=0,o=!1){let n=t=>{t.preventDefault(),console.log("type of this.nomolizerWheelDelta",typeof this.normalizeWheelDelta);let e=this.normalizeWheelDelta(t);this.pos+=-e*this.speed,this.moving||this.update(t)};t===document&&(t=document.scrollingElement||document.documentElement||document.body.parentNode||document.body),this.speed=e,this.smooth=i,this.moving=!1,this.scrollTop=3e3*s,this.pos=this.scrollTop,this.frame=t===document.body&&document.documentElement?document.documentElement:t,t.addEventListener("wheel",n,{passive:o}),t.addEventListener("DOMMouseScroll",n,{passive:o})}normalizeWheelDelta(t){return t.detail?t.wheelDelta?t.wheelDelta/t.detail/40*(t.detail>0?1:-1):-t.detail/3:t.wheelDelta/120}update(t){this.moving=!0;let e=(this.pos-this.scrollTop)/this.smooth;this.scrollTop+=e,this.onUpdate&&this.onUpdate(e,t),Math.abs(e)>1?E(()=>{this.update()}):this.moving=!1}}var E=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3)};let M=(t,e)=>{let i,s,o,n;t instanceof Function&&(e=t,t=document.documentElement||document.body),"string"==typeof t&&(t=document.querySelector(t));let a={x:0,y:0},r=0,h=0,l=!0,u=function(){l=!0};t.addEventListener("mousedown",u);let p=t=>{a=c(t)};t.addEventListener("mousemove",p);let g=function(t){t&&(a=c(t))};t.addEventListener("wheel",g),t.addEventListener("touchstart",u,!!(()=>{let t=!1;try{let e=Object.defineProperty({},"passive",{get(){t=!0}});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){console.error(e),t=!1}return t})()&&{passive:!0}),t.addEventListener("contextmenu",t=>(t.preventDefault(),!1),!1);let f=0,x=0;i=new d({source:t,update(e,i){l&&(l=!1,r=a.x,h=a.y);let s={target:t,type:"mouse",dx:e-x,dy:i-f,dz:0,x:a.x,y:a.y,x0:r,y0:h,isRight:a.isRight};x=e,f=i,w(s)},stop(){w({target:t,type:"mouse",dx:0,dy:0,dz:0,x:a.x,y:a.y,x0:r,y0:h})},multiplier:1,friction:.75}),new O(t,80,12,0).onUpdate=(e,i)=>{null==i&&(i+=i),w({target:t,type:"mouse",dx:0,dy:0,dz:e,x:a.x,y:a.y,x0:a.x,y0:a.y})};let y=function(t){t=t||window;var e=new(m()),i=[null,null],s=0,o=0,n=!1,a=!1;return Object.defineProperties(e,{pinching:()=>2===s,fingers:()=>i}),h(),e.enable=h,e.disable=function(){a&&(a=!1,s=0,i[0]=null,i[1]=null,o=0,n=!1,t.removeEventListener("touchstart",l,!1),t.removeEventListener("touchmove",c,!1),t.removeEventListener("touchend",d,!1),t.removeEventListener("touchcancel",d,!1))},e.indexOfTouch=r,e;function r(t){for(var e=t.identifier,s=0;s<i.length;s++)if(i[s]&&i[s].touch&&i[s].touch.identifier===e)return s;return -1}function h(){a||(a=!0,t.addEventListener("touchstart",l,!1),t.addEventListener("touchmove",c,!1),t.addEventListener("touchend",d,!1),t.addEventListener("touchcancel",d,!1))}function l(a){for(var h=0;h<a.changedTouches.length;h++){var l=a.changedTouches[h];if(-1===r(l.identifier)&&s<2){var c=0===s,d=i[0]?1:0,p=i[0]?0:1,g=new v;i[d]=g,s++,g.touch=l,b(l,t,g.position);var m=i[p]?i[p].touch:void 0;if(e.emit("place",l,m),!c){var f=u();n=!1,e.emit("start",f),o=f}}}}function c(n){for(var a=!1,h=0;h<n.changedTouches.length;h++){var l=n.changedTouches[h],c=r(l);-1!==c&&(a=!0,i[c].touch=l,b(l,t,i[c].position))}if(2===s&&a){var d=u();e.emit("change",d,o),o=d}}function d(t){for(var o=0;o<t.changedTouches.length;o++){var a=t.changedTouches[o],h=r(a);if(-1!==h){i[h]=null,s--;var l=0===h?1:0,c=i[l]?i[l].touch:void 0;e.emit("lift",a,c)}}n||2===s||(n=!0,e.emit("end"))}function u(){var t,e,o,n;return s<2?0:(t=i[0].position,Math.sqrt((o=(e=i[1].position)[0]-t[0])*o+(n=e[1]-t[1])*n))}}(t);function w(t){if(null!=n){o?(o.dx+=t.dx,o.dy+=t.dy,o.dz+=t.dz,o.x=t.x,o.y=t.y):o=t;return}n=j(()=>{if(e(t),n=null,o){let t=o;o=null,w(t)}})}return y.on("start",t=>{null==t&&(t+=t);let e=y.fingers[0],o=y.fingers[1];s=[.5*o.position[0]+.5*e.position[0],.5*o.position[1]+.5*e.position[1]],i&&i.pause()}),y.on("end",()=>{s&&(s=null,i&&i.resume())}),y.on("change",(e,i)=>{y.pinching&&s&&w({target:t,type:"touch",dx:0,dy:0,dz:-(2*(e-i)),x:s[0],y:s[1],x0:s[0],y0:s[0]})}),function(){t.removeEventListener("mousedown",u),t.removeEventListener("mousemove",p),t.removeEventListener("touchstart",u),i.destroy(),t.removeEventListener("wheel",g),y.disable(),j.cancel(n)}},z=function(t,e,i){return i>e?Math.max(Math.min(t,i),e):Math.max(Math.min(t,e),i)};var A=Math.abs,L=Math.min;function S(t,e,i,s){var o=A(t-e);return null==i&&(i=S.DBL_EPSILON),null==s&&(s=i),!!(o<=i||o<=s*L(A(t),A(e)))||t===e}S.FLT_EPSILON=11920929e-14,S.DBL_EPSILON=2220446049250313e-31;let R=Math.log10||function(t){return Math.log(t)/Math.log(10)};function T(t,e,i){var s=t%e;return i||(i=S.FLT_EPSILON),!!(!s||S(0,s,i,0)||S(Math.abs(e),Math.abs(s),i,0))}function W(t,e){var i=Math.floor(R(t)),s=Math.pow(10,i),o=e.map(t=>t*s);s=Math.pow(10,i+1),o=o.concat(e.map(t=>t*s));for(var n=0,a=0;a<o.length&&!((n=o[a])>=t);a++);return n}let P=(t,e)=>{e||(e=[0,""]);var i=parseFloat(t=String(t),10);return e[0]=i,e[1]=t.match(/[\d.\-\+]*\s*(.*)/)[1]||"",e};var D={ch:8,ex:7.15625,em:16,rem:16,in:96,cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,px:1};function Y(t){if("[object Object]"!==Object.prototype.toString.call(t))return!1;let e=Object.getPrototypeOf(t);return null===e||e===Object.getPrototypeOf({})}class F extends m(){constructor(t){super(t),this._options=t||{},Object.assign(this,t)}}let B=F,X=function(t,e){let i=t.replace(/[^\d,]/g,"").split(",");return null==e&&(e=i[3]||1),i[3]=e,"rgba("+i.join(",")+")"},I={steps:[1,2,5],distance:20,unit:10,lines:t=>{let e=t.coordinate,i=t.step=W(e.distance*e.zoom,e.steps);return function(t,e,i){if(null!=t&&"number"!=typeof t)throw Error("start must be a number or null");if(null!=e&&"number"!=typeof e)throw Error("stop must be a number or null");if(null!=i&&"number"!=typeof i)throw Error("step must be a number or null");null==e&&(e=t||0,t=0),null==i&&(i=e>t?1:-1);for(var s=[],o=t<e;o?t<e:t>e;t+=i)s.push(t);return s}(Math.floor(t.offset/i)*i,Math.ceil((t.offset+t.range)/i+1)*i,i)},lineColor:t=>{if(!t.lines)return;let e=t.coordinate,i=X(e.color,.1),s=X(e.color,.3),o=t.step,n=Math.ceil(R(o)),a=10**n,r=10**(n+1),h=o/10;return t.lines.map(t=>T(t,r,h)?s:T(t,a,h)?i:null)},ticks:t=>{if(!t.lines)return;let e=t.coordinate,i=W(1.1*W(1.1*t.step,e.steps),e.steps),s=i/10,o=4*t.axisWidth;return t.lines.map(t=>!T(t,i,s)||S(t,0,s)?null:o)},labels:t=>{if(!t.lines)return;let e=t.coordinate,i=W(1.1*W(1.1*t.step,e.steps),e.steps),s=i/100;return t.lines.map(t=>T(t,i,s)?S(t,0,s)?"y"===e.orientation?null:"0":(t=Number((t/100).toFixed(2)),e.format(t)):null)}};class U{constructor(t,e){Object.assign(this,e),this.orientation=t||"x"}getCoords(t){let e=[];if(!t)return e;for(let i=0;i<t.length;i+=1){let s=this.getRatio(t[i]);e.push(s),e.push(0),e.push(s),e.push(1)}return e}getRange(){let t=this.width;return"y"===this.orientation&&(t=this.height),t*this.zoom}getRatio(t){return(t-this.offset)/this.range}setOffset(t){this.offset=t}update(t){Object.assign(this,t=t||{}),this.range=this.getRange()}}class _ extends B{constructor(t,e){super(e),this.canvas=t,this.context=this.canvas.getContext("2d"),this.state={},this.setDefaults(),this.update(e)}render(){return this.draw(),this}getCenterCoords(){let t=this.state.x,[e,i]=t.shape,[s,o,n,a]=t.padding,r=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite),h=s+r[1]*(i-s-n);return t=this.state.y,[e,i]=t.shape,[s,o,n,a]=t.padding,{x:a+(r=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite))[0]*(e-o-a),y:h}}setSize(t,e){this.setWidth(t),this.setHeight(e)}setWidth(t){this.canvas.width=t}setHeight(t){this.canvas.height=t}update(t){t||(t={});let e=[this.canvas.width,this.canvas.height];return this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this}update2(t){let e=[this.canvas.width,this.canvas.height];Object.assign(this.center,t),this.state.x=this.calcCoordinate(this.axisX,e,this),this.state.y=this.calcCoordinate(this.axisY,e,this),this.state.x.opposite=this.state.y,this.state.y.opposite=this.state.x,this.emit("update",t),this.axisX.offset=t.x,this.axisX.zoom=1/t.zoom,this.axisY.offset=t.y,this.axisY.zoom=1/t.zoom}calcCoordinate(t,e){let i,s,o;let n={coordinate:t,shape:e,grid:this};if(n.range=t.getRange(n),n.offset=z(t.offset-n.range*z(.5,0,1),Math.max(t.min,-Number.MAX_VALUE+1),Math.min(t.max,Number.MAX_VALUE)-n.range),n.zoom=t.zoom,n.axisColor="number"==typeof t.axisColor?X(t.color,t.axisColor):t.axisColor||t.color,n.axisWidth=t.axisWidth||t.lineWidth,n.lineWidth=t.lineWidth,n.tickAlign=t.tickAlign,n.labelColor=n.color,"number"==typeof t.padding?n.padding=[,,,,].fill(t.padding):t.padding instanceof Function?n.padding=t.padding(n):n.padding=t.padding,"number"==typeof t.fontSize)n.fontSize=t.fontSize;else{let e=P(t.fontSize);n.fontSize=e[0]*function t(e){if(!e)return null;if(D[e])return D[e];var i=P(e);if(!isNaN(i[0])&&i[1]){var s=t(i[1]);return"number"==typeof s?i[0]*s:null}return null}(e[1])}if(n.fontFamily=t.fontFamily||"sans-serif",i=t.lines instanceof Function?t.lines(n):t.lines||[],n.lines=i,t.lineColor instanceof Function)n.lineColors=t.lineColor(n);else if(Array.isArray(t.lineColor))n.lineColors=t.lineColor;else{let e=X(t.color,t.lineColor);"number"!=typeof t.lineColor&&(e=!1===t.lineColor||null==t.lineColor?null:t.color),n.lineColors=Array(i.length).fill(e)}if(t.ticks instanceof Function)s=t.ticks(n);else if(Array.isArray(t.ticks))s=t.ticks;else{let e=!0===t.ticks||!0===t.ticks?2*n.axisWidth:t.ticks||0;s=Array(i.length).fill(e)}return n.ticks=s,o=!0===t.labels?n.lines:t.labels instanceof Function?t.labels(n):Array.isArray(t.labels)?t.labels:Y(t.labels)?t.labels:Array(n.lines.length).fill(null),n.labels=o,Y(s)&&(n.ticks=Array(i.length).fill(0)),Y(o)&&(n.labels=Array(i.length).fill(null)),Y(s)&&Object.keys(s).forEach((t,e)=>{n.ticks.push(e),n.lines.push(parseFloat(t)),n.lineColors.push(null),n.labels.push(null)}),Y(o)&&Object.keys(o).forEach((t,e)=>{n.labels.push(t),n.lines.push(parseFloat(e)),n.lineColors.push(null),n.ticks.push(null)}),n}setDefaults(){this.pixelRatio=window.devicePixelRatio,this.autostart=!0,this.interactions=!0,this.defaults=Object.assign({type:"linear",name:"",units:"",state:{},minZoom:-1/0,maxZoom:1/0,min:-1/0,max:1/0,offset:0,origin:.5,center:{x:0,y:0,zoom:1},zoom:1,zoomEnabled:!0,panEnabled:!0,labels:!0,fontSize:"11pt",fontFamily:"sans-serif",padding:0,color:"rgb(0,0,0,1)",lines:!0,tick:8,tickAlign:.5,lineWidth:1,distance:13,style:"lines",lineColor:.4,axis:!0,axisOrigin:0,axisWidth:2,axisColor:.8,getCoords:()=>[0,0,0,0],getRatio:()=>0,format:t=>t},I,this._options),this.axisX=new U("x",this.defaults),this.axisY=new U("y",this.defaults),this.axisX=Object.assign({},this.defaults,{orientation:"x",offset:this.center.x,getCoords:(t,e)=>{let i=[];if(!t)return i;for(let s=0;s<t.length;s+=1){let o=e.coordinate.getRatio(t[s],e);i.push(o),i.push(0),i.push(o),i.push(1)}return i},getRange:t=>t.shape[0]*t.coordinate.zoom,getRatio:(t,e)=>(t-e.offset)/e.range}),this.axisY=Object.assign({},this.defaults,{orientation:"y",offset:this.center.y,getCoords:(t,e)=>{let i=[];if(!t)return i;for(let s=0;s<t.length;s+=1){let o=e.coordinate.getRatio(t[s],e);i.push(0),i.push(o),i.push(1),i.push(o)}return i},getRange:t=>t.shape[1]*t.coordinate.zoom,getRatio:(t,e)=>1-(t-e.offset)/e.range}),Object.assign(this,this.defaults),Object.assign(this,this._options),this.center=new a(this.center)}draw(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawLines(this.state.x),this.drawLines(this.state.y),this}drawLines(t){if(!t||!t.coordinate)return;let e=this.context,[i,s]=t.shape,[o,n,a,r]=t.padding,h=t.opposite.coordinate.getRatio(t.coordinate.axisOrigin,t.opposite);h=z(h,0,1);let l=t.coordinate.getCoords(t.lines,t);e.lineWidth=1;for(let h=0,c=0;h<l.length;h+=4,c+=1){let d=t.lineColors[c];if(!d)continue;e.strokeStyle=d,e.beginPath();let u=0+r+l[h]*(i-n-r),p=0+o+l[h+1]*(s-a-o),g=0+r+l[h+2]*(i-n-r),m=0+o+l[h+3]*(s-a-o);e.moveTo(u,p),e.lineTo(g,m),e.stroke(),e.closePath()}let c=[];for(let t=0;t<l.length;t+=4){let e=l[t],i=l[t+1],s=l[t+2],o=l[t+3],n=s-e,a=o-i,r=Math.sqrt(n*n+a*a);c.push(n/r),c.push(a/r)}let d=[];t.labelCoords=[];let u=t.ticks;for(let e=0,p=0,g=0;e<c.length;g+=1,e+=2,p+=4){let m=l[p],f=l[p+1],b=l[p+2],v=l[p+3],x=(b-m)*h,y=(v-f)*h,w=[c[e]*u[g]/(i-r-n),c[e+1]*u[g]/(s-o-a)];d.push(c[e]*(x+w[0]*t.tickAlign)+m),d.push(c[e+1]*(y+w[1]*t.tickAlign)+f),d.push(c[e]*(x-w[0]*(1-t.tickAlign))+m),d.push(c[e+1]*(y-w[1]*(1-t.tickAlign))+f),t.labelCoords.push(c[e]*x+m),t.labelCoords.push(c[e+1]*y+f)}if(u.length){e.lineWidth=t.axisWidth/2,e.beginPath();for(let h=0,l=0;h<d.length;h+=4,l+=1){if(S(t.lines[l],t.opposite.coordinate.axisOrigin))continue;let c=0+r+d[h]*(i-r-n),u=0+o+d[h+1]*(s-o-a),p=0+r+d[h+2]*(i-r-n),g=0+o+d[h+3]*(s-o-a);e.moveTo(c,u),e.lineTo(p,g)}e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}if(t.coordinate.axis&&t.axisColor){let h=t.opposite.coordinate.getCoords([t.coordinate.axisOrigin],t.opposite);e.lineWidth=t.axisWidth/2;let l=0+r+z(h[0],0,1)*(i-n-r),c=0+o+z(h[1],0,1)*(s-o-a),d=0+r+z(h[2],0,1)*(i-n-r),u=0+o+z(h[3],0,1)*(s-o-a);e.beginPath(),e.moveTo(l,c),e.lineTo(d,u),e.strokeStyle=t.axisColor,e.stroke(),e.closePath()}this.drawLabels(t)}drawLabels(t){if(t.labels){let e=this.context,[i,s]=t.shape,[o,n,a,r]=t.padding;e.font=`300 ${t.fontSize}px ${t.fontFamily}`,e.fillStyle=t.labelColor,e.textBaseline="top";let h=t.fontSize,l=t.axisWidth+1.5,c=t.tickAlign<.5?-h-2*t.axisWidth:2*t.axisWidth,d="y"===t.coordinate.orientation&&!t.opposite.disabled;for(let u=0;u<t.labels.length;u+=1){let p=t.labels[u];if(null==p||d&&S(t.lines[u],t.opposite.coordinate.axisOrigin))continue;let g=e.measureText(p).width,m=t.labelCoords[2*u]*(i-r-n)+l+r;"y"===t.coordinate.orientation&&(m=z(m,l,i-g-1-t.axisWidth),p*=-1);let f=t.labelCoords[2*u+1]*(s-o-a)+c+o;"x"===t.coordinate.orientation&&(f=z(f,0,s-h-c)),e.fillText(p,m,f)}}}}let N=t=>class extends t{setMode(t){switch(this.mode=t,t){case r.SELECT:this.canvas.isDrawingMode=!1,this.canvas.interactive=!0,this.canvas.selection=!0,this.canvas.hoverCursor="default",this.canvas.moveCursor="default";break;case r.GRAB:this.canvas.isDrawingMode=!1,this.canvas.interactive=!1,this.canvas.selection=!1,this.canvas.discardActiveObject(),this.canvas.hoverCursor="move",this.canvas.moveCursor="move";break;case r.MEASURE:this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush.color="transparent",this.canvas.discardActiveObject();break;case r.DRAW:this.canvas.isDrawingMode=!0}}setModeAsDraw(){this.setMode(r.DRAW)}setModeAsSelect(){this.setMode(r.SELECT)}setModeAsMeasure(){this.setMode(r.MEASURE)}setModeAsGrab(){this.setMode(r.GRAB)}isSelectMode(){return this.mode===r.SELECT}isGrabMode(){return this.mode===r.GRAB}isMeasureMode(){return this.mode===r.MEASURE}isDrawMode(){return this.mode===r.DRAW}};class Z{constructor(t){if((t=t||{}).hasBorders=!1,t.selectable=!1,t.hasControls=!1,t.class="measurer",t.scale=t.scale||1,this.options=t||{},this.start=this.options.start,this.end=this.options.end,this.canvas=this.options.map.canvas,this.completed=!1,!this.start||!this.end)throw Error("start must be defined");this.draw()}clear(){this.objects&&this.objects.forEach(t=>{this.canvas.remove(t)})}draw(){this.clear();let{start:t,end:e}=this;t=new a(t),e=new a(e);let i=t.add(e).multiply(.5);this.line=new fabric.Line([t.x,t.y,e.x,e.y],{stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1,selectable:!1,evented:!1,strokeDashArray:[5,5]});let s={left:t.x,top:t.y,strokeWidth:1,radius:this.options.radius||1,fill:this.options.fill||"#3e82ff",stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1},o={left:t.x,top:t.y,strokeWidth:1,radius:this.options.radius||5,fill:this.options.fill||"#3e82ff33",stroke:this.options.stroke||"#3e82ff",hasControls:!1,hasBorders:!1};this.circle1=new fabric.Circle(o),this.circle2=new fabric.Circle({...o,left:e.x,top:e.y}),this.circle11=new fabric.Circle(s),this.circle22=new fabric.Circle({...s,left:e.x,top:e.y});let n=Math.round(t.distanceFrom(e));n=`${n/100} m`,this.text=new fabric.Text(n,{textBackgroundColor:"black",fill:"white",left:i.x,top:i.y-10,fontSize:12,hasControls:!1,hasBorders:!1,selectable:!1,evented:!1}),this.objects=[this.line,this.text,this.circle11,this.circle22,this.circle1,this.circle2],this.objects.forEach(t=>{this.canvas.add(t)}),this.line.hasControls=!1,this.line.hasBorders=!1,this.line.selectable=!1,this.line.evented=!1,this.registerListeners()}setStart(t){this.start=t,this.draw()}setEnd(t){this.end=t,this.draw()}complete(){this.completed=!0}registerListeners(){this.circle2.on("moving",t=>{this.setEnd(t.pointer)}),this.circle1.on("moving",t=>{this.setStart(t.pointer)})}applyScale(t){this.start.x*=t,this.start.y*=t,this.end.x*=t,this.end.y*=t,this.draw()}}class G{constructor(t){this.map=t,this.measurer=null}onMouseMove(t){let e={x:t.absolutePointer.x,y:t.absolutePointer.y};this.measurer&&!this.measurer.completed&&(this.measurer.setEnd(e),this.map.canvas.requestRenderAll())}onClick(t){let e={x:t.absolutePointer.x,y:t.absolutePointer.y};this.measurer?this.measurer.completed||(this.measurer.setEnd(e),this.measurer.complete()):this.measurer=new Z({start:e,end:e,map:this.map})}}let q=t=>new $(t);class ${constructor(t){this.superclass=t||class{}}with(...t){return t.reduce((t,e)=>e(t),this.superclass)}}class H extends q(B).with(N){constructor(t,e){super(e),this.defaults=Object.assign({},h),Object.assign(this,this.defaults),Object.assign(this,this._options),this.center=new a(this.center),this.container=t||document.body;let i=document.createElement("canvas");this.container.appendChild(i),i.setAttribute("id","indoors-map-canvas"),i.width=this.width||this.container.clientWidth,i.height=this.height||this.container.clientHeight,this.canvas=new fabric.Canvas(i,{preserveObjectStacking:!0,renderOnAddRemove:!0}),this.context=this.canvas.getContext("2d"),this.on("render",()=>{this.autostart&&this.clear()}),this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2,this.canvas.absolutePan({x:this.originX,y:this.originY}),this.x=this.center.x,this.y=this.center.y,this.dx=0,this.dy=0;try{this.addFloorPlan()}catch(t){console.error(t)}this.showGrid&&this.addGrid(),this.setMode(this.mode||r.GRAB),M(this.container,t=>{this.panzoom(t)}),this.registerListeners(),setTimeout(()=>{this.emit("ready",this)},300),this.measurement=new G(this)}addFloorPlan(){this.floorplan&&this.floorplan.on("load",t=>{this.addLayer(t)})}addLayer(t){if(!t.shape){console.error("shape is undefined");return}if(this.canvas.add(t.shape),this.canvas._objects.sort((t,e)=>t.zIndex-e.zIndex),t.shape.keepOnZoom){let e=1/this.zoom;t.shape.set("scaleX",e),t.shape.set("scaleY",e),t.shape.setCoords(),this.emit(`${t.class}scaling`,t)}t.class&&this.emit(`${t.class}:added`,t),this.canvas.requestRenderAll()}removeLayer(t){t&&t.shape&&(t.class&&this.emit(`${t.class}:removed`,t),this.canvas.remove(t.shape))}addGrid(){this.gridCanvas=this.cloneCanvas(),this.gridCanvas.setAttribute("id","indoors-grid-canvas"),this.grid=new _(this.gridCanvas,this),this.grid.draw()}moveTo(t,e){void 0!==e&&(t.zIndex=e),this.canvas.moveTo(t.shape,t.zIndex)}cloneCanvas(t){t=t||this.canvas;let e=document.createElement("canvas");return e.width=t.width,e.height=t.height,t.wrapperEl.appendChild(e),e}setZoom(t){let{width:e,height:i}=this.canvas;this.zoom=z(t,this.minZoom,this.maxZoom),this.dx=0,this.dy=0,this.x=e/2,this.y=i/2,this.update(),process.nextTick(()=>{this.update()})}getBounds(){let t=1/0,e=-1/0,i=1/0,s=-1/0;return this.canvas.forEachObject(o=>{o.getBounds().forEach(o=>{t=Math.min(t,o.x),e=Math.max(e,o.x),i=Math.min(i,o.y),s=Math.max(s,o.y)})}),[new a(t,i),new a(e,s)]}fitBounds(t=100){this.onResize();let{width:e,height:i}=this.canvas;this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2;let s=this.getBounds();this.center.x=(s[0].x+s[1].x)/2,this.center.y=-(s[0].y+s[1].y)/2;let o=Math.abs(s[0].x-s[1].x)+t,n=Math.abs(s[0].y-s[1].y)+t;this.zoom=Math.min(e/o,i/n),this.canvas.setZoom(this.zoom),this.canvas.absolutePan({x:this.originX+this.center.x*this.zoom,y:this.originY-this.center.y*this.zoom}),this.update(),process.nextTick(()=>{this.update()})}setCursor(t){this.container.style.cursor=t}reset(){let{width:t,height:e}=this.canvas;this.zoom=this._options.zoom||1,this.center=new a,this.originX=-this.canvas.width/2,this.originY=-this.canvas.height/2,this.canvas.absolutePan({x:this.originX,y:this.originY}),this.x=t/2,this.y=e/2,this.update(),process.nextTick(()=>{this.update()})}onResize(t,e){let i=this.canvas.width,s=this.canvas.height;t=t||this.container.clientWidth,e=e||this.container.clientHeight,this.canvas.setWidth(t),this.canvas.setHeight(e),this.grid&&this.grid.setSize(t,e);let o=t/2-i/2,n=e/2-s/2;this.canvas.relativePan({x:o,y:n}),this.update()}update(){let t=this.canvas;this.grid&&this.grid.update2({x:this.center.x,y:this.center.y,zoom:this.zoom}),this.emit("update",this),this.grid&&this.grid.render(),t.zoomToPoint(new a(this.x,this.y),this.zoom),this.isGrabMode()||this.isRight?(t.relativePan(new a(this.dx,this.dy)),this.emit("panning"),this.setCursor("grab")):this.setCursor("pointer");let e=Date.now();if(!this.lastUpdatedTime&&100>Math.abs(this.lastUpdatedTime-e))return;this.lastUpdatedTime=e;let i=t.getObjects(),s=!1;for(let t=0;t<i.length;t+=1){let e=i[t];e.keepOnZoom&&(e.set("scaleX",1/this.zoom),e.set("scaleY",1/this.zoom),e.setCoords(),s=!0,this.emit(`${e.class}scaling`,e))}s&&t.requestRenderAll()}panzoom(t){let{width:e,height:i}=this.canvas,s=z(-t.dz,-(.75*i),.75*i)/i,o=1/this.zoom,n=o*(1-s);n=z(n,this.minZoom,this.maxZoom);let{x:a,y:r}=this.center;if(this.isGrabMode()||t.isRight?(a-=o*t.dx,r+=o*t.dy,this.setCursor("grab")):this.setCursor("pointer"),this.zoomEnabled){let s=t.x/e-.5;a-=e*(n-o)*s;let h=.5-t.y/i;r-=i*(n-o)*h}this.center.setX(a),this.center.setY(r),this.zoom=1/n,this.dx=t.dx,this.dy=t.dy,this.x=t.x0,this.y=t.y0,this.isRight=t.isRight,this.update()}setView(t){this.dx=0,this.dy=0,this.x=0,this.y=0,t.y*=-1;let e=this.center.x-t.x,i=-this.center.y+t.y;this.center.copy(t),this.canvas.relativePan(new a(e*this.zoom,i*this.zoom)),this.canvas.renderAll(),this.update(),process.nextTick(()=>{this.update()})}registerListeners(){this.canvas.on("object:scaling",t=>{if(t.target.class){this.emit(`${t.target.class}:scaling`,t.target.parent),t.target.parent.emit("scaling",t.target.parent);return}let e=t.target;if(!e.getObjects)return;let i=e.getObjects();e.removeWithUpdate();for(let t=0;t<i.length;t+=1){let e=i[t];e.orgYaw=e.parent.yaw||0,e.fire("moving",e.parent),this.emit(`${e.class}:moving`,e.parent)}this.update(),this.canvas.requestRenderAll()}),this.canvas.on("object:rotating",t=>{if(t.target.class){this.emit(`${t.target.class}:rotating`,t.target.parent,t.target.angle),t.target.parent.emit("rotating",t.target.parent,t.target.angle);return}let e=t.target;if(!e.getObjects)return;let i=e.getObjects();for(let t=0;t<i.length;t+=1){let s=i[t];"marker"===s.class&&(s._set("angle",-e.angle),s.parent.yaw=-e.angle+(s.orgYaw||0),s.fire("moving",s.parent),this.emit(`${s.class}:moving`,s.parent),s.fire("rotating",s.parent),this.emit(`${s.class}:rotating`,s.parent))}this.update()}),this.canvas.on("object:moving",t=>{if(t.target.class){this.emit(`${t.target.class}:moving`,t.target.parent),t.target.parent.emit("moving",t.target.parent);return}let e=t.target;if(!e.getObjects)return;let i=e.getObjects();for(let t=0;t<i.length;t+=1){let e=i[t];e.class&&(e.fire("moving",e.parent),this.emit(`${e.class}:moving`,e.parent))}this.update()}),this.canvas.on("object:moved",t=>{if(t.target.class){this.emit(`${t.target.class}dragend`,t),this.emit(`${t.target.class}:moved`,t.target.parent),t.target.parent.emit("moved",t.target.parent),this.update();return}let e=t.target;if(!e.getObjects)return;let i=e.getObjects();for(let t=0;t<i.length;t+=1){let e=i[t];e.class&&(e.fire("moved",e.parent),this.emit(`${e.class}:moved`,e.parent))}this.update()}),this.canvas.on("selection:cleared",t=>{let e=t.deselected;if(e&&e.length)for(let t=0;t<e.length;t+=1){let i=e[t];"marker"===i.class&&(i._set("angle",0),i._set("scaleX",1/this.zoom),i._set("scaleY",1/this.zoom),i.parent&&(i.parent.inGroup=!1),i.fire("moving",i.parent))}}),this.canvas.on("selection:created",t=>{let e=t.selected;if(e&&!(e.length<2))for(let t=0;t<e.length;t+=1){let i=e[t];i.class&&i.parent&&(i.parent.inGroup=!0,i.orgYaw=i.parent.yaw||0)}}),this.canvas.on("selection:updated",t=>{let e=t.selected;if(e&&!(e.length<2))for(let t=0;t<e.length;t+=1){let i=e[t];i.class&&i.parent&&(i.parent.inGroup=!0,i.orgYaw=i.parent.yaw||0)}}),this.canvas.on("mouse:down",t=>{this.dragObject=t.target}),this.canvas.on("mouse:move",t=>{this.isMeasureMode()&&this.measurement.onMouseMove(t),this.dragObject&&this.dragObject.clickable&&(this.dragObject===t.target?this.dragObject.dragging=!0:this.dragObject.dragging=!1),this.isRight=!1,"which"in t.e?this.isRight=3===t.e.which:"button"in t.e&&(this.isRight=2===t.e.button),this.emit("mouse:move",t)}),this.canvas.on("mouse:up",t=>{if(this.isMeasureMode()&&this.measurement.onClick(t),this.isRight=!1,this.dx=0,this.dy=0,this.dragObject&&t.target&&t.target.selectable||(t.target=null,this.emit("mouse:click",t)),this.dragObject&&this.dragObject.clickable){if(this.dragObject!==t.target)return;this.dragObject.dragging||this.modeToggleByKey||this.emit(`${vm.dragObject.class}:click`,this.dragObject.parent),this.dragObject.dragging=!1}this.dragObject=null}),window.addEventListener("resize",()=>{this.onResize()})}unregisterListeners(){this.canvas.off("object:moving"),this.canvas.off("object:moved")}getMarkerById(t){let e=this.canvas.getObjects();for(let i=0;i<e.length;i+=1){let s=e[i];if("marker"===s.class&&s.id===t)return s.parent}return null}getMarkers(){let t=[],e=this.canvas.getObjects();for(let i=0;i<e.length;i+=1){let s=e[i];"marker"===s.class&&t.push(s.parent)}return t}}class V extends fabric.Group{constructor(t,e){super(t,e=e||{})}getBounds(){let t=[];return t.push(new a(this.left-this.width/2,this.top-this.height/2)),t.push(new a(this.left+this.width/2,this.top+this.height/2)),t}}class J extends B{constructor(t){super(t),this.label=void 0!==this.label?this.label:null,this.draggable=this.draggable||!1,this.zIndex=this.zIndex||1,this.opacity=this.opacity||1,this.keepOnZoom=this.keepOnZoom||!1,this.clickable=this.clickable||!1,this.hoverCursor=this.hoverCursor||this.clickable?"pointer":"default",this.moveCursor=this.moveCursor||"move",this.style={zIndex:this.zIndex,class:this.class,parent:this,keepOnZoom:this.keepOnZoom,id:this.id,hasControls:!1,hasBorders:!1,lockMovementX:!this.draggable,lockMovementY:!this.draggable,draggable:this.draggable,clickable:this.clickable,evented:this.clickable,selectable:this.draggable,hoverCursor:this.hoverCursor,moveCursor:this.moveCursor}}setOptions(t){this.shape&&(Object.keys(t).forEach(e=>{this.shape.set(e,t[e])}),this.shape.canvas&&this.shape.canvas.renderAll())}addTo(t){if(!t){this._map&&this._map.removeLayer(this);return}this._map=t,this._map.addLayer(this)}}class K extends J{constructor(t){super(t),this.load=()=>{let t=this.url.lastIndexOf(".");"svg"===this.url.substr(t+1,3)?fabric.loadSVGFromURL(this.url,(t,e)=>{t=t.filter(t=>"grid"!==t.id);let i=fabric.util.groupSVGElements(t,e);this.setImage(i)}):fabric.Image.fromURL(this.url,t=>{this.setImage(t)},{selectable:!1,opacity:this.opacity}),this.handler=new fabric.Rect({left:0,top:0,width:.1,height:.1,stroke:"black",fill:"",hasControls:!1,hasBorders:!1})},this.width=this.width||-1,this.height=this.height||-1,this.position=new a(this.position),this.class="floorplan",this.load()}setImage(t){this.shape&&this.image&&this.shape.remove(this.image);let e=t.width/t.height;-1===this.width&&-1===this.height?(this.width=t.width,this.height=t.height):-1===this.width?this.width=this.height*e:-1===this.height&&(this.height=this.width/e),t.originalWidth=t.width,t.originalHeight=t.height,this.image=t.scaleToWidth(this.width,!0),this.scaleX=t.scaleX+0,this.scaleY=t.scaleY+0,this.drawShape()}drawShape(){if(this.shape){this.shape.addWithUpdate(this.image),this.emit("load",this);return}this.shape=new V([this.image,this.handler],{selectable:!1,draggable:!1,left:this.position.x,top:this.position.y,parent:this,lockMovementX:!0,lockMovementY:!0,class:this.class,zIndex:this.zIndex}),this.emit("load",this)}setWidth(t){this.width=t,this.onResize()}setHeight(t){this.height=t,this.onResize()}setOpacity(t){this.opacity=t,this.image.set("opacity",t),this.image.canvas&&this.image.canvas.renderAll()}setPosition(t){this.position=new a(t),this.shape&&this.shape.set({left:this.position.x,top:this.position.y})}setUrl(t){this.url=t,this.load()}onResize(t,e){void 0!==t&&(this.width=t),void 0!==e&&(this.height=e);let i=this.image.width/this.image.height;-1===this.width&&-1===this.height?(this.width=this.image.width,this.height=this.image.height):-1===this.width?this.width=this.height/i:-1===this.height&&(this.height=this.width*i),this.image=this.image.scaleToWidth(this.width),this.shape.addWithUpdate()}}class Q extends fabric.Line{constructor(t,e){(e=e||{}).strokeWidth=e.strokeWidth||1,e.class="line",super(t,e),this._strokeWidth=e.strokeWidth}_renderStroke(t){let e=this._strokeWidth/this.canvas.getZoom();this.strokeWidth=e>.01?e:.01,super._renderStroke(t),this.setCoords()}}class tt extends J{constructor(t,e,i){if((i=i||{}).zIndex=i.zIndex||10,i.class="connector",super(i),!t||!e){console.error("start or end is missing");return}this.start=t,this.end=e,this.strokeWidth=this.strokeWidth||1,Object.assign(this.style,{strokeWidth:this.strokeWidth,stroke:this.color||"grey",fill:this.fill||!1,selectable:!1}),this.draw(),this.registerListeners()}registerListeners(){this.start.on("update:links",()=>{this.shape.set({x1:this.start.position.x,y1:this.start.position.y})}),this.end.on("update:links",()=>{this.shape.set({x2:this.end.position.x,y2:this.end.position.y})})}draw(){this.shape=new Q([this.start.position.x,this.start.position.y,this.end.position.x,this.end.position.y],this.style)}redraw(){this.shape.set({x1:this.start.position.x,y1:this.start.position.y,x2:this.end.position.x,y2:this.end.position.y})}setStart(t){this.start=t,this.redraw()}setEnd(t){this.end=t,this.redraw()}setColor(t){this.color=t,this.style.stroke=t,this.shape.set("stroke",t),this.shape.canvas&&this.shape.canvas.renderAll()}setStrokeWidth(t){this.strokeWidth=t,this.style.strokeWidth=t,this.shape.set("strokeWidth",t),this.shape.canvas&&this.shape.canvas.renderAll()}}class te extends J{constructor(t,e){(e=e||{}).zIndex=e.zIndex||100,e.keepOnZoom=void 0===e.keepOnZoom||e.keepOnZoom,e.position=new a(t),e.rotation=e.rotation||0,e.yaw=e.yaw||0,e.clickable=void 0===e.clickable||e.clickable,e.class="marker",super(e),this.text=this.text||"",this.size=this.size||10,this.textColor=this.textColor||"black",this.fill=this.fill||"white",this.stroke=this.stroke||"red",Object.assign(this.style,{left:this.position.x,top:this.position.y,angle:this.rotation,yaw:this.yaw,clickable:this.clickable}),this.text&&(this.textObj=new fabric.Text(this.text,{fontSize:this.size,fill:this.textColor})),this.icon?fabric.Image.fromURL(this.icon.url,t=>{this.image=t.scaleToWidth(this.size),this.init()},{selectable:!1,evented:this.evented,clickable:this.clickable,opacity:this.opacity}):(this.circle=new fabric.Circle({radius:this.size,strokeWidth:2,stroke:this.stroke,fill:this.fill}),this.init())}init(){let t=[];this.image&&t.push(this.image),this.circle&&t.push(this.circle),this.textObj&&t.push(this.textObj),this.shape=new V(t,this.style),this.links=this.links||[],this.addLinks(),this.registerListeners(),process.nextTick(()=>{this.emit("ready")})}registerListeners(){this.shape.on("moving",()=>{this.onShapeDrag()}),this.shape.on("rotating",()=>{this.emit("rotating")}),this.shape.on("mousedown",t=>{this.onShapeMouseDown(t)}),this.shape.on("mousemove",t=>{this.onShapeMouseMove(t)}),this.shape.on("mouseup",t=>{this.onShapeMouseUp(t)}),this.shape.on("mouseover",()=>{this.emit("mouseover",this)}),this.shape.on("mouseout",()=>{this.emit("mouseout",this)})}setPosition(t){this.position=new a(t),this.shape&&(this.shape.set({left:this.position.x,top:this.position.y}),this.emit("update:links"),this.shape.canvas&&this.shape.canvas.renderAll())}setRotation(t){this.rotation=t,this.shape&&(this.shape.set({angle:this.rotation}),this.shape.canvas&&this.shape.canvas.renderAll())}setOptions(t){this.shape&&(Object.keys(t).forEach(e=>{switch(e){case"textColor":this.setTextColor(t[e]);break;case"stroke":this.setStroke(t[e]);break;case"fill":this.setColor(t[e])}}),this.shape.canvas&&this.shape.canvas.renderAll())}setTextColor(t){this.text&&this.textObj&&(this.textObj.setColor(t),this.textObj.canvas.renderAll())}setText(t){this.text&&this.textObj&&(this.textObj.set({text:t}),this.textObj.canvas.renderAll())}setStroke(t){this.circle&&this.circle.set("stroke",t)}setColor(t){this.circle&&this.circle.setColor(t)}setLinks(t){this.links=t,this.addLinks()}setSize(t){this.image?(this.image.scaleToWidth(t),this.image.canvas&&this.image.canvas.renderAll()):this.circle&&this.circle.setRadius(t)}addLinks(){this.connectors=[],this.links.forEach(t=>{let e=new tt(this,t);this.connectors.push(e)}),this.addConnectors()}addConnectors(){this.connectors.forEach(t=>{this._map.addLayer(t)})}onAdded(){this.addConnectors()}onShapeDrag(){let[,,,,t,e]=this.shape.calcTransformMatrix();this.position=new a(t,e),this.emit("update:links"),this.emit("moving")}onShapeMouseDown(t){this.dragStart=t}onShapeMouseMove(t){if(this.dragStart){this.emit("dragstart");let e=new fabric.Point(t.pointer.x,t.pointer.y),i=new fabric.Point(this.dragStart.pointer.x,this.dragStart.pointer.y);e.distanceFrom(i)>3&&(this.dragStart=null,this.dragging=!0)}this.dragging?this.emit("drag"):this.emit("hover")}onShapeMouseUp(){this.dragging?this.emit("moved"):this.emit("click"),this.dragStart=null,this.dragging=!1}}var ti=i(6248);let ts=(0,ti.createServerReference)("60c96956bcfa6a4d961911d2705fcea86abb69f712",ti.callServer,void 0,ti.findSourceMapURL,"getUrlFromHierarchy"),to=({tag:t})=>{let[e,i]=(0,o.useState)(),[n,a]=(0,o.useState)(800),[r,h]=(0,o.useState)(400),[l,c]=(0,o.useState)(!0),[d,u]=(0,o.useState)(!1),p=()=>{u(!d)},g=async(t,e)=>{let s=await ts(t,e);void 0!==s&&i(s)},m=(0,o.useRef)(null);return((0,o.useEffect)(()=>{let i;let s=()=>{let e=0-n/2,i=0-r/2;return{locationX:6.096*t?.location.x+e,locationY:6.096*t?.location.y+i}};if(g(t?.location.hierarchy.split("!")[1],t?.location.hierarchy.split("!")[2]),t&&(c(!1),function(t,e){let i=new Image;i.onload=function(){e(i.width,i.height)},i.onerror=function(){},i.src=t}(e,(t,e)=>{a(t),h(e)}),m.current)){let o=m.current;return o.innerHTML="",(e=>{i=[];let o=new te([s().locationX,s().locationY],{text:t?.name,draggable:!1,zIndex:100,id:"Asset 1"});o.addTo(e),i.push(o),setTimeout(()=>{},1e3)})(new H(o,{floorplan:new K({url:e,opacity:.7,width:n,height:r,zIndex:1}),minZoom:.5,maxZoom:3,center:{x:0,y:0,zoom:1}})),()=>{}}},[t,e,n,r]),l)?(0,s.jsx)("div",{children:"loading..."}):(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)("div",{ref:m,style:{width:"100%",height:"600px",position:"relative"}}),(0,s.jsx)("button",{onClick:p,className:"bg-blue-300 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded top-1 right-1 absolute",children:"i"}),d?(0,s.jsx)("div",{className:"tooltip",children:(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-75",onClick:p,children:(0,s.jsx)("div",{className:"bg-white text-white- rounded-lg shadow-lg p-8 ",onClick:t=>t.stopPropagation(),children:(0,s.jsxs)("table",{className:"table-auto border border-blue-800 rounded",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"bg-blue-800 text-white",children:(0,s.jsx)("th",{className:"p-4 text-xl",colSpan:2,children:" Info "})})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-4 text-top border border-blue-800",children:"Zoom In / Out"}),(0,s.jsx)("td",{className:"p-4 text-top border border-blue-800",children:"Mouse Scroll"})]}),(0,s.jsxs)("tr",{className:"py-8",children:[(0,s.jsx)("td",{className:"p-4 text-top border border-blue-800",children:"Drag Arround"}),(0,s.jsx)("td",{className:"p-4 text-top border border-blue-800",children:"Mouse Right Click Button"})]})]})]})})})}):(0,s.jsx)(s.Fragment,{})]})}}};